----

1. 機能設計

要求された機能を実現するための不整合や機能不足、重複開発を防ぐため、仕様上不要な場合を除き以下の設計ドキュメントが揃っており、関係者間での認識合わせができていること。

- 運用フローと運用機能仕様
- システム間のデータ連携フローとIF仕様
- データ集計フローとログ設計

----

2. 高リスクな機能設計

複雑なロジックや課金・ポイントに関わる機能を構築する場合、より重点的にビジネスロジックをフロー化し、整合性やリスクの確認を行うこと

----

3. フロントエンドの例外処理

フロントエンドのロジックで処理を行う場合、エラー発生時や不正値を受け取った場合の挙動が明確になっていること

障害事例：2017/2 ポイントためる ポイントガチャで正しい当選情報が表示されない

----

4. 改修時の影響範囲

新規のシステム構築ではなく既存システムに改修を行う場合、改修対象のサーバ設定/DB定義/利用クラス・ライブラリなどの影響範囲を明確にすること

----

5. 機能拡張

初期リリース後に機能拡張が予定されている場合、対応方針について設計に盛り込まれていること

----

6. ユーザ権限

権限設定について留意が必要なディレクトリやファイル(FTP接続、API提供など)の洗い出しと、設定されるべき権限が確定しているか。
・対象ディレクトリ・ファイル
・設定するパーミッション

----

7. 時刻を利用したロジック設計

時刻を判定する機能を構築する場合、特別な場合を除き端末ローカルの時刻をパラメータとして利用せず、サーバサイドの時刻を利用すること。

障害事例：2015/6/20　 auスマートパス 野球速報枠の表示不具合 端末の時計を使用してパラメーターを作成していたため、意図しないキャッシュが作成され野球速報が前日の速報を表示してしまう障害

----

8. 端末キャッシュへの対処

クライアントにてキャッシュされる内容を明確にしておくこと。
将来的な機能改修時に、CSS、Javascript、画像などのクライアントキャッシュが残る条件を明記しておくこと。

新規構築ではなく機能改修の場合、上記の条件が確認されていること。
   
----

9. 端末キャッシュの利用範囲

LocalStorage, Cache, Cookieに永続化が必要なデータを登録しないこと。
永続化が必要なデータは、APIなどを用いてサーバ上のデータベースに保存すること。

----

10. キャッシュ設計

キャッシュの設計については個別にドキュメント化しチーム内で確認をすること。
ユーザ固有の情報以外のレスポンスは極力キャッシュ化し、パフォーマンスを考慮した最適な設計がされているかを確認すること。

----

11. DB設計におけるパフォーマンス考慮

大量データを扱うなどパフォーマンス懸念が想定されるテーブルについて、インデックス、パーティショニングなどの考慮が設計に盛り込まれているか。

----

12. データ処理のタイミング考慮

データを操作するタイミング（ユーザアクションをトリガーとしたデータ処理/バックグラウンドでのバッチ処理）は適切か。
データ処理にリアルタイム性が求められない機能や大量データを操作する機能はバッチ処理で実装すること。

----

13. バックグラウンド処理によるパフォーマンス影響の考慮

大量データを処理するバッチ処理、管理機能などにより、DBレスポンスが遅延する/テーブルロックがかかるなどユーザ向け機能に影響を及ぼすリスクはないか。
レコード数やファイルサイズなどを判定しデータの入出力に上限を設けるバリデーション機能が考慮されているか。

----

14. バッチの二重起動

バッチの処理において、二重起動、追い越しの可能性が考慮されているか。
以下の観点で確認されていること。

- 処理が長時間化する条件
- 二重起動が発生する時間
- 二重起動が発生した場合の挙動
   - データの取り込み漏れなどへの防止策
- 三重〜N重起動の可能性
   
障害事例：2014/11/17 ポイントためる　バッチ処理にてポイント二重付与障害発生
処理件数が多く、１回のバッチ時間が次々回のバッチ起動まで伸びてしまった。バッチ起動中の判断をファイル有無で判断しバッチを二重起動しないように制御していたが、１回目の二重起動チェックの際に起動中判断のファイルを削除してしまい、２回目の二重起動チェックでバッチ未起動と判断してバッチが並行して処理してしまった。
 
 ----
 
バッチ処理の実行頻度・実行タイミング、実行順序は確定しているか。
(※可能な限り早めの段階で確定・対応すること)

----

異常終了時の検知と復旧について、実運用を考慮した設計にすること。
(※影響のない後続処理まで止まってしまわない作りにすること)
(※極力、異常終了時の1次対応はKCCS側で対応が可能な作りにすること)

----

不要データ(DB)、不要ログ、有効期限切れの画像データのデータクレンジング処理の必要性を検討したか。

----

運用上必要となる管理機能(作業効率、ミス防止の観点から)の実装が検討されているか。
(※手作業で登録する場合、ミスが発生しやすいような管理画面に対して、必要なバリデーションや登録時の便利機能などの実装が考慮されているか
　　便利機能例：画像やファイルの容量上限の入力チェックまたは入力フォーム近くへの容量上限表記など)
(※短時間でまとまった件数の登録が必要なものについて、アップロード機能などの一括登録機能の実装が考慮されているか)
(※2014/09/05リニューアル改修時の「アプリ取り放題一部機種表示不具合」で容量を超える画像をアップロードしブラウザが強制終了となる障害が発生したため、便利機能例を追記)

----

各ページごとに、静的要素と動的要素の区分、および、動的部分の内容が明確になっているか。
動的要素のうち、CMSで更新できる要素が明確になっているか。

----

セキュリティルームでのサービス運用を想定している場合、セキュリティルームからのみアクセス可能とする仕組みを設計に盛り込んでいるか。
(※特定のIPアドレスのみアクセスできるようにFirewallで制御するなど)
(※ここから先の画面はセキュリティルームからのみのアクセスとしたい、というような要件の場合、制御対象の画面を初めから別ドメインにしておくなど、設計・開発が複雑にならないように設計の段階で工夫すること)

----

決済、ポイントに関する機能の場合、二重決済や決済漏れを防止するために、ステータス同期処理、データ整合性確認処理などの実装の必要性を検討したか。
(※au簡単決済で過去に発生した障害を元に当項目を追加)

----

ユーザー別に表示内容が異なる画面について、他者の情報が表示されないように、キャッシュの利用有無をきちんと検討した上で、画面別のキャッシュ設定を設計すること。
(※過去に発生した「ログイン後のトップ画面で他者のポイントが表示される」障害を機に、当項目を追加)
(※過去に発生した「ローソンクーポンの重複発行」障害を機に、当項目を追加)

----

会員番号などの1人につき1つ発番されるような項目について、必ずユニークになるような発番の仕組み、もしくは必要な排他制御の実装が検討されているか。
(※新規会員登録が同タイミングで複数発生した際に、通常1人につき1つ発番される会員管理IDを複数人が共有できる仕組みとなっていたことにより、過去に発生した情報漏洩障害に基づき、当項目を追加)

----

Cookieはリクエストヘッダによりサーバに送信される、またJavascriptから読み取られるため、適切なオプションを付与して利用すること。（httponlyによりJavascriptからの読み取り不可対応、LocalStorageを使用する、など）

----

なりすましや改ざんが容易であるため、Cookie でユーザを識別するような API を作成しない（OAuth などを使うこと）

----

他システム連携を行う処理の場合、連携先システムとの接続エラーが発生した場合の仕様、システムの挙動について明確になっているか。また、サービス要求元とその仕様について合意できているか。
(※連携先システムの障害やメンテナンスにより接続できない場合や、NW障害により接続できない場合など)

----

個人情報を取り扱う管理画面については、仕組み上実装不可な場合を除き、以下のガイドラインを折り込んだ設計にすること。
・IDはグループではなく、個人単位とすること
・定期的にパスワードを変更させる機能を実装すること(ガイドラインは1ヶ月)
※仕組み上実装不可な場合はその理由をコメント欄(Z列)に記載すること

----

個人情報を送受信する場合は必ずSSL通信を使用すること。
(※SSL通信はSSL3.0以上、もしくは、TSL1.0以上とし、利用可能な暗号化方式における共通鍵の鍵長は128bit以上とすること)

----

SSL証明書のバージョンを確認する。
※ AWSの場合cloudfrontでSSLを利用する場合、Android2系をサポートする場合としない場合で設定が異なる
　　（EOSLのポイントプログラム移管ののリリース直前に、Android2系の実機でcssや画像が読み込めない事象が発生し、
　　　 SSL証明書の設定を変更した。
　　　　下記URLの「3.独自SSL証明書」から「2.独自SSL証明書」に設定を変更
　　　　参考：http://dev.classmethod.jp/cloud/cloudfront-ssl-options-summary/）

----

httpsのサイト内にhttpのリクエストが混在していないことを確認する。
※画像やCSS、ajaxなど

----
