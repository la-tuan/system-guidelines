[Back to Contents](README.md)


# Webアプリケーションセキュリティチェックリスト

※2016/11/1現在HTTP/2に関することは考慮されていない

## 入力検証および不正データ入力時の無効化

### 悪意のある文字列の入力チェックまたは無害化
- [ ] 入力値が、仕様として規定している以外の形式（文字種・文字長・数値の範囲等）の場合、サーバ側でエラーとし、入力を認めない
- [ ] 入力値に、特殊文字を許容する必要がある場合、業務要件に応じサーバ側で入力時、または使用時に特殊文字のエスケープ処理をすること

### SQLインジェクションの防御
- [ ] SQL文の組み立てにバインド機構を用いること
- [ ] SQL文のLIKE句を記述する場合、およびバインド機構を実装できない場合は、SQL文を構成する全ての変数や演算結果に対し特殊文字のエスケープ処理を実施すること。（特殊文字はデータベースによって異なるので、各々に合わせて実施する。）
また、数値リテラルに対しては、数値以外の入力値を認めないこと。
- [ ] 入力値に、テーブル名やカラム名、SQL文を直接指定しないこと
- [ ] 操作可能なデータベースの表、列、あるいは実行可能なSQLコマンドを極力制限する
- [ ] データベースにおいて、OSコマンドを起動できる場合、OSユーザとしての権限を極力制限する
- [ ] データベースに関わるエラーメッセージをブラウザ上に表示させないこと

### コマンドインジェクションの防御
- [ ] シェルを起動できる言語機能の使用する場合は、入力値を引数として使用しないこと

### ディレクトリトラバーサルの防御
- [ ] サーバ内ディレクトリやファイルを使用する場合は、入力値によりパスを生成しないこと
- [ ] サーバ内のファイルに対して有するアクセス権限を最低限にすること
- [ ] アクセス可能なディレクトリ、ファイルは必要最小限とすること

### 改竄防御
- [ ] 入力値のvalue属性にて指定する値には改竄されても困らないデータだけを格納すること
- [ ] 改竄されると危険な重要情報は、サーバ上のメモリやデータで管理すること
- [ ] URLを入力値より生成する場合は、想定外のプロトコルやドメインへのリンクやフォームを作成できないようにすること

### クロスサイトスクリプティングの防御
Webページに出力する全ての要素に対して、出力箇所に応じ適切な処理（エスケープ処理等）を実施しスクリプトの混入を許可しないこと
- [ ] 入力値だけでなくデータベースやファイル等から取り出した値など、出力するもの全てに対して処理を実施すること
- [ ] aタグのhref属性などURLを出力する箇所においては、「http://」あるいは「https://」で始まるURLのみを許可するよう、ホワイトリストによるチェックを行う
- [ ] CSSには、expression()プロパティによってスクリプトの混入が可能であるため、入力値に基づいたCSSの生成は避ける。やむを得ず出力する場合は、ホワイトリストによって許容する文字を制限する
- [ ] scriptタグに挟まれた箇所、あるいは onchangeなどon...で名前が始まるイベントハンドラ属性のJavaScript文中に出力して利用する場合は、type属性がhiddenであるinputタグの属性に出力し、JavaScriptからDOMを用いて参照する。

外部からの不正なスクリプトの実行を防止するため、AJAXの非同期通信によるリクエストを受け付けるWebアプリケーションは、その非同期通信以外によるリクエストを受け付けないようにすること
- [ ] あらかじめクライアント側にて特殊なリクエストヘッダ（X-Requested-With 等、任意も可）を付加し、サーバ側でそのリクエストヘッダの有無を確認する。リクエストヘッダが付加されている場合に限り通常のレスポンスを返す。
- [ ] ファイルタイプの誤認を防ぐため、サーバのレスポンスヘッダに「X-Content-Type-Options: nosniff」を付加し、出力されたコンテンツが正しく解釈されるようにすること(IEのみ)
- [ ] レスポンスヘッダのContent-Typeフィールドには、適切な文字コードを設定すること

### HTTPレスポンス分割の防御
- [ ] 入力値をHTTPレスポンスヘッダに出力する場合は、改行コードをそのまま出力しないこと

### メールヘッダインジェクションの防御
- [ ] 入力値をメールヘッダとして使用する場合は、改行コードをそのまま出力しないこと
- [ ] メールアドレスはRFC5321やRFC5322に基づいたホワイトリストチェックを行うこと

### 不正ファイルアップロードの防御
ファイルをアップロードさせる場合、以下のような観点から許可するファイルの種別を制限すること。なお、アップロードされたファイルのURLが外部からわからないようにするのが望ましい。
- [ ] ファイルのContetnt-Type
- [ ] ファイルの拡張子
- [ ] ファイルのヘッダ
- [ ] 画像などのバイナリファイルの場合、サーバ側で加工するのが望ましい（画像の場合、２倍に拡大して半分に縮小する等）

## セッション管理


## 認証と承認


## クロスサイトリクエストフォージェリ(CSRF)の防御

## クリックジャッキングの防御

## 機密データの暗号化

## 開発言語の特性によって必要な対策

## 暴露対策

## その他の留意点
