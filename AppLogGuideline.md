# 目的

アプリケーションログを有効活用することでシステムの健全化を図るとともにサービス品質を向上させる。
システムログ出力を画一的にすることで、共通基盤でスムーズに分析しやすいようにする。

* システムエラーを検知し改善する
* アクセスやエラーの傾向を分析する
* 不正アクセスを検知し対策を行なう

# ログレベル

* Debug
  * テスト時に出力するレベル。商用では出力しない。
* Info
  * 実行状態を把握するために出力するレベル。商用では極力出力しない。
  * ミッションクリティカルなシステム(課金やポイント、入退会など)で、障害発生時やユーザからの申告で実行状況を調査する可能性のあるシステムは出力する
* Warn
  * 致命的ではないが想定外の挙動をした時に出力するレベル。
  * 外部システムとの接続不可、キャッシュからのデータ取得不可など今後エラーレベルが上る可能性があるもの
* Error
  * 予期しないエラーでサービス及びシステムに影響があり、調査及び復旧が必要な時に出力するレベル。
  * 発生したエラーによってユーザ、クライアントや運用者側に問題があるもの
* Fatal
  * アプリケーションの継続が困難な時に出力するレベル。至急復旧作業を要する。

# 出力ログフォーマット

```
{
  "level":"ログレベル",
  "status":"HTTPステータス",
  "date":"YYYY/MM/DD hh:mi:ss",
  "referer":"リファラ",
  "ip":"接続元IPアドレス",
  "ua":"ユーザーエージェント",
  "responsetime":"レスポンスタイム",
  "url":"アクセス先URL",
  "host":"ホスト名",
  "app":{ //アプリケーション毎に設定する任意の値(例)
    "code":"アプリケーション結果コード",
    "uid":"ユーザーID", //OZで発行されたUID
  }
}
```

# ログ収集

flentd, logstash, embalkで定期的に収集
リアルタイム性は求めない
