# リリースガイドライン

## はじめに
このガイドラインでは、medibaにおける、サービスリリースについてのガイドラインを下記の大項目に分け、それぞれ定めます。

* テストについて
* リリース体制
* リリース手順
* リリース後に確認する事項

## テストについて

### 検証範囲について
検証するべき範囲を把握し対象を整理しましょう。
主に意識しておくべき項目を以下に述べます。

#### 対応デバイス・OS・ブラウザ
- 対応デバイスと非対応デバイスをきちんと把握しておきましょう。
    - 対応しているデバイスでもそれぞれで挙動の違いも把握しておきましょう。非対応デバイスにおいても同様です。
- OSによる挙動の違いも把握しておきましょう。
    - SPであればAndroidとiOS、PCであればWindowsとMAC等、対象とするデバイスにどんなOSがあるかを確認しましょう。
- 対応ブラウザと非対応ブラウザをきちんと把握しておきましょう。
    - バージョンによって挙動が変わることもありうるので、動作保証するバージョンの範囲を明確しましょう。
    - アプリ経由でのWebviewがある場合は、そちらも検証しましょう。

#### テストケースについて
- 環境的またはシステム的に任意で発生させることのできないイレギュラーケースがある場合は、代替手段か品質担保できる根拠を明確にしましょう

### 個人情報関連
- 個人情報をあつかう機能は、対象ユーザーに他ユーザーの個人情報が絶対に見えないを確認しましょう。
    - 特に大量ユーザーへのメール送信といった複数対象の場合は、以下の点に注意しましょう。
　　　　 1.別の人の情報が送信されている(1件前に処理した内容が次の人に送信されている、など)
        1.本人にも通知メールが送られているが、本人以外にもその情報が送られている

### 外部システム連携
- I/F機能の場合、対象データがゼロ件の場合の仕様について、対向システムと整合し、連携テストを実施する

### 非機能要件について
非機能要件について、決めておくべき項目を以下に述べます。

#### 性能試験

#### 脆弱性試験

### その他
- テスト期間において解消できなかった問題がないか把握しておきましょう。
    - 解消されなかった問題はいつまでに解決可能か、解決までにどんな不具合があるかを整理しましょう。


## リリース体制
リリース計画を立てる上で、決めておくべき体制を以下に述べます。

### リリース担当者
- リリース担当者を明確にしておきましょう。また、リリース後の特別体制による監視を実施する場合はシフトを考慮するようにしましょう。

### 関係者
社内および社外において、連携が必要な関係者を整理しておきしましょう。その際、連絡手段を決めておきましょう。
意識しておくべき主な関係者を以下に列挙します。
- プロジェクト責任者
- サービス編成担当
- 外部ベンダ担当
- KDDI サービス担当
- 対向システム担当
他、協業CP担当 etc...


### 問題発生時の連絡・対応フロー
- リリース作業において問題が発生した場合の連絡およびエスカレーション先や、対応フローを明確にしておきましょう。


## リリース手順

### リリースタイムスケジュール
- オンライン、ジョブ、他システム連携などを考慮した上でリリース実施するようにしましょう。
- フロント・バックエンド・DB操作など、リリースの順序による影響を整理し、一番リスクのないリリース順序を検討しましょう。

### 手順書について
- 手順書を作成したメンバ以外も作業を実施できるよう事前にレビューをしましょう。
    - コンポーネント単位で作業者が違い場合、それぞれのリリース作業の実施タイミングの認識合わせをしましょう。
- 一部コンポーネントを先行リリースを行う場合、他コンポーネントに影響がないことの確認手順をいれましょう。
- 属人的な手順は可能な限り代替手段を検討しましょう。
- 切り戻し手順は準備されていることを確認しましょう。
    - リリースしたものを全てを対象とするか一部を対象にするだけで良いかを意識しましょう。
- リリース作業の間、サービスを一般ユーザーに公開して良いかを確認しましょう。
    - メンテナンスへの切り替えが必要な場合、開始と終了の手順も作成しましょう。
    - メンテナンスの間に、社内よりサービスの動作検証を確認できる方法を用意しておきましょう。
- 監視設定の無効化の手順が含まれている事を確認しましょう。
- 対向システムとの連携がある場合は、初回稼働のタイミングを明確にしておきましょう。バッチ連携の場合は、手動での初回連携が必要かどうかも意識しましょう。
- LBに関して、サーバ（インスタンス）の切り離しが必要かを確認しましょう。必要な場合は、その手順を盛り込みましょう。
- DB構造の変更および大量データ操作の際は、バックアップとロールバック手順も明確にするとともに、作業にかかる正確な時間を把握しておきましょう。


## リリース作業
リリース作業時において、気をつけておくべき事項を以下に述べます。

### 作業実施の前に
- 停止するべきジョブやプロセス、プロセスが適切に停止されていることを確認しましょう。
- メンテナンス切替を実施する場合は、社外ネットワークからサービスがメンテナンス状態になっている事を確実に確認しましょう。複数人で確認を取る事を推奨します。
- アラート監視に影響するリリース作業の際は、監視無効化されていることを確認しましょう。
    - KCCSの場合は、作業申請の更新を行いましょう。
- 切り戻しの為に必須となる資材のバックアップが適切に行われている事を確認しましょう。ダブルチェックを実施する事を推奨します。

### アプリケーションデプロイ
- gitを利用してリリース資材を管理している場合は、対象とするブランチの確認および改修内容が確実に含まれていることを確認しましょう。
- デプロイ実施により、不要資材の削除される場合は

#### デプロイ対象の確認
- デプロイ操作の際は、対象となるサーバ（インスタンス）を確認しましょう。ダブルチェックを実施することを推奨します。
- 対象サーバ(インスタンス)をLBから切り離す必要のある場合は、ログなどからユーザアクセスがないことを確認の上、実施しましょう。


#### 対向システムとの繋ぎこみ
- 初回の連携においては、ログなどを確認し確実に疎通およびレスポンスが受け取れていることを確認しましょう。
- 想定外のエラーが発生した場合、状況を対向システム担当にすぐ連絡しましょう。
- ファイルI/Fの場合、確認するべき事項を以下に述べます。
    - 送受信フォルダへの書き込み権限が想定通りとなっていること
    - 送受信フォルダの空き容量が充分であること
    - 可能であれば送信先受信先サーバにファイルが正常に送受信されたかを目視で確認すること
    - 送受信ファイルサイズが0バイトなどになっていないこと
    - 送受信ファイルの中身が正常であること
        - 文字コードなどは特に注意すること

### DB操作

##### DB構造変更

##### データ操作

##### データ移行

### キャッシュについて

### メンテナンス切り替えがある場合

#### メンテナンス中の検証について

### 作業経過の報告について


## リリース後に確認する事項

### ジョブ・Cronの再開と設定、および手動実行バッチの確認

### リリース漏れ資材・サーバーのチェック

### メンテナンス解除

### 監視の有効化・再開

## リリース完了後の振り返り

### ヒヤリハットとか

