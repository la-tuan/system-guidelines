TODO: ファイル名を変更 SecurityGuideline4WebApplication

# 1. 入力検証及び不正入力時の無効化

悪意のあるユーザが不正な文字列を組み込むことで、本来アクセス権限のないデータを入手、改竄、破壊などユーザからの入力を出力画面に含む前に、適切なエスケー プや入力検証での確認をしない場合、脆弱になります。

## 1.1. インジェクション

SQLとOS、LDAPなどのインジェクション欠陥は、信頼されていないデータがコマンド又はクエリの一部として インタプリタに送信される際に発生します。攻撃者の悪意のあるデータは、意図しないコマンドの実行や適 切な権限のないデータアクセスをさせるように、インタプリタを騙すことができます。

### 1.1.1. SQLインジェクションの防御

### 1.1.2. コマンドインジェクションの防御

### 1.1.3. ディレクトリトラバーサルの防御

### 1.1.4. HTTPレスポンス分割の防御

### 1.1.5. メールヘッダインジェクションの防御

### 1.1.6. 不正ファイルアップロードの防御

### 1.1.7. 改竄防御

## 1.2. クロスサイトスクリプト(XSS)

XSS欠陥は、アプリケーションが信頼されていないデータを受け取る時、適切な検証やエスケープをせずに、 ウェブブラウザに送信する際に発生します。XSSにより、攻撃者は被害者のブラウザでスクリプトを実行で き、ユーザセッションのハイジャックやウェブサイトの改竄、またユーザを悪意のあるサイトにリダイレクトす ることが可能です。

# 2. セッション管理と認証の不備

認証とセッション管理に関連するアプリケーション機能は、しばしば正しく実装されていません。そのため、 攻撃者はパスワード又は鍵、セッショントークンを漏洩させたり、他の実装の不備を悪用してなりすますこ とができます。

## 2.1. セッション管理

セッション管理にあたってはセッションハイジャック対策を実施すること

## 2.2. 認証と承認

なりすましや管理者権限の不正取得などができないよう、適切な措置を講ずること。

# 3. クロスサイトフォージェリー(CSRF)

CSRF攻撃は、脆弱性のあるWebアプリケーションに対し、ログオンしている被害者のブラウザから、偽造さ れたHTTPリクエストを送信させます。そのリクエストには、被害者のセッションクッキーや他の自動的に組 み込まれた認証情報が含まれています。これにより、攻撃者は脆弱性のあるアプリケーションに、ユーザ からの正当なリクエストとして認識されるリクエス トを被害者のブラウザに生成させることができます。

# 4. 安全でないオブジェクト 直接参照

オブジェクトの直接参照は、開発者がファイル又はディレクトリ、データベースのキーなど、内部に実装され ているオブジェクトへの参照を公開する際に発生します。アクセス制御チェックや他の保護が無ければ、攻 撃者はこれらの参照を用い、アクセス権限のないデータへアクセスすることができます。

# 5. セキュリティ 設定のミス

適切なセキュリティには、アプリケーション、フレームワーク、アプリケーションサーバ、Webサーバ、データ ベースサーバ、およびプラットフォームに対して、セキュアな設定を定義して反映させる事が必要です。製 品のデフォルト設定は安全ではない場合が多いため、セキュアな設定が定義・実装・維持されないといけ ません。また、ソフトウェアを最新の状態に保つ必要があり ます。

# 6. 機密データの露出

## 6.1 脆弱性概要

機密データを暗号化していないこと、また弱いアルゴリズムによるパスワードハッシュなどで発生する脆弱性となります。
攻撃者は通常暗号化を直接破ることはせず、サーバやユーザのブラウザから転送中の平文を盗みます。万一のデータ流出時にもデータ内容を解読、悪用されないよう対策を講じ、また、機密データの誤った公開や意図しないファイルの流出を抑止するための対策が必要となります。

## 6.2 対策

## 6.2.1. サイトのSSL化

ログインやお客様情報といった認証を必要とする画面は、SSLを使用すること。

## 6.2.2. 機密データの暗号化

機密データを盗聴や盗難から守り、万一のデータ流出時にもデータ内容を解読、悪用されないよう以下の対策を実施すること

* パスワードや個人情報を暗号化すること
 * 暗号化のアルゴリズムはどうするか

## 6.2.3. 公開ディレクトリへの配置

ログファイル、バックアップファイル、設定ファイルなど公開を前提としたファイルは、公開ディレクトリ上に配置しない。また、HTTPサーバーのディレクトリスティングは無効にする。

## 6.2.4. 通信時のデータ保護

機密情報をクエリストリングに含めないこと、また重要情報のURLは規則性を持たせず不規則な英数字や記号を交えた長い文字列にすることで難読化を行なう。

# 7. 機能レベル アクセス制御の欠落

# 7.1. 脆弱性概要

ネットワークアクセス可能なシステムであれば誰でもリクエスト送信出来るため、適切な権限設定がされていない場合、URLやパラメータを改変し、本来保護されるべき機能やデータへアクセスされます。

# 7.2. 対策

# 7.2.1. 機能分離とユーザー権限

* 提供先に応じたネットワークレベルの公開設定を適切に行なう
* 一人一ユーザーとして、権限を明確に設定する

# 7.2.2. 暗黙的拒否

* デフォルトはアクセス拒否し、ユーザーに対して必要な権限設定を付与する


# 8. 既知の脆弱性を持つコンポーネントの使用

# 8.1. 脆弱性概要

ライブラリ、フレームワーク、および他のソフトウェアモジュールなどのコンポーネントは、ほとんど常にフル 権限で実行されます。脆弱なコンポーネントが悪用される場合、深刻なデータ損失やサーバ乗っ取りまで に至る攻撃ができます。既知の脆弱性を持つコンポーネントを使用するアプリケーションは、アプリケー ションの防御を弱体化し、様々な攻撃と影響も可能になります。

# 8.2. 対策

# 8.2.1. 情報収集

下記から定期的に情報収集を行ない、深刻な脆弱性を早期発見する。
* [JVN](http://jvndb.jvn.jp/index.html)などの公的機関
* 品質管理経由で周知されるKDDI脆弱性情報
* 利用しているOSSのアップデートやIssue

# 8.2.2. 利用技術の精査と限定化

* 不要のパッケージは使用せずに削除する
* OSSの利用には信頼性を確認する

# 8.2.3. 最新バージョンの利用

* 初期構築時にOS、ライブラリなどバージョンを最新にする
* 運用フェーズにおいて定期的にバージョンアップさせる

# 8.2.4. テスト自動化の推進

深刻な脆弱性が発覚しても影響範囲を確認が必要なため即アップデートは出来ません。
アップデートを迅速に行なうため下記の環境を用意するべきです。
* 機能に対してテストコードを用意し機械的にテストが実行出来る
* CI(継続的インテグレーション)環境を導入し自動的に不具合検知が出来る


# 9. 未検証の リダイレクトと フォーワード

Webアプリケーションは、頻繁にユーザを他の画面やウェブサイトへリダイレクト・フォーワードしますが、信 頼されていないデータを用いて、転送先画面を決定しています。適切な検証がないと、攻撃者は被害者を フィッシングサイトやマルウェアサイトへリダイレクトできたり、フォーワードで閲覧権限のない画面へアクセ スできます。

* 単なるリダイレクトやフォワードの使用は行わない
* リダイレクト先をホワイトリスト化する  ※medibaでリダイレクトサーバーの脆弱性があった


# 検討項目

* 管理画面の操作ログは最低半年くらい残す
* アクセスログは最低3ヶ月くらい残す
* 無駄なポートはあけるな
* 踏み台は作り直sshはしない
* 共通アカウントは使用せずに各自に発行
  * システムもCMSもサービスも
* UIDは暗号化すること
  * 生のUIDはログに落とすな
  * 暗号化方式は軍司さんに相談　可逆的なものでもいいのか
* セキュリティチェックリストを準拠せよ
* DBのrootは使うな
* ZAPをかませ
* 本番データを扱う管理システムはログイン方式にしなさい

... 続く
