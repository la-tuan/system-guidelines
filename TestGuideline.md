# テストガイドライン

## はじめに
本ガイドラインではmedibaにおけるリリースを伴うテストについて、下記6つの分類に定めます。
不具合の混入を未然に防ぎ　“ 安定した品質を提供 ”　する事を目的としています。

* 1.テスト計画
* 2.単体テスト
* 3.性能試験
* 4.脆弱性試験
* 5.結合テスト
* 6.総合テスト

## 1.テスト計画
開発初期においてマスターテストプランを作成しましょう。
マスターテストプランとは、ソフトウェア開発におけるテスト工程で作成されるべき文書の標準規格であるIEEE829-2008で規定されている文書で、  
対象プロジェクトでのテストがうまくいくようにテスト設計の方法（アプローチ）や考え方をまとめた内容を記載するものです。
マスターテストプランに定義すべき項目を以下に述べます。

### テスト概要
* 対象サービス、対象システムにおいてどのようなテストを行うか全体概要を定義します。

### テスト目的
* テストの実行目的を定義します。
* 単体テスト、結合テスト、総合テストといったテストレベルに対して、機能テスト、性能テスト、負荷テスト、セキュリティテストといったテストタイプごとに定義します。

### テストの対象システムとテストスコープ
* テスト対象システムと、テストレベルごとのテストスコープを定義します。


### テストスケジュール
* テストの目的を達成できるよう、テストレベルごとにテストスケジュールを定義します。

### テスト実行環境
* テストを実行する環境と、デバイス・OS・ブラウザ・ネイティブアプリなどの環境条件を定義します。

### コミュニケーションプラン、ステークホルダー
* 不具合レポート先ツールや実施結果、テスト報告を必要とするメンバーやバグ切り分けメンバー、プロジェクト責任者などを定義します。

### テスト基準
* 開始条件、終了基準、中断基準、追加基準などを定義します。

### テスト成果物
* マスターテストプラン、テスト設計書、テストケース、不具合レポート、テスト報告書などの成果物を定義します。

### テスト実行について
テスト実行において主に意識しておくべき項目を以下に述べます。

#### テストレベルについて
* 開発規模、重要度、難易度、サービスの目的などにより実施するテストレベルや各テストレベルで実施する詳細を定義します。  
* テストレベルとは、単体テスト、結合テスト、総合テストのように、開発プロジェクトにおいて組織的に管理するためのテスト作業の段階を指します。
* medibaでは以下の条件にあてはまる案件は、重要度や難易度の高い開発案件として取り扱います。 テストレベルも複数レベルで実施しましょう。
   * 新規構築サービス、システム
   * 大規模リニューアル
   * 個人情報の取得/表示取り扱いがある案件
   * ポイント機能にかかわる新規開発、改修案件
   * 課金機能にかかわる新規開発、改修がある案件
   * SLA基準が高い案件（ライフメディア、KDDIサービス等）
   * 業務要件、運用要件が複雑で全体要件の難易度が高い案件
   * 新規、既存の開発を伴う広告案件
   * フロントエンドで新規デザイン手法を使った案件
   * 機種依存による表示懸念がある案件
   * プロジェクト全体で3人月以上想定案件
* 下記にテストレベルと対応する実施担当、テスト環境の一覧を示します。
   * 原則として実施担当が該当テストレベルの責務を担うこととします。

| テストレベル   | 実施担当                      | テスト環境                |
| -------------  |-------------------------------|---------------------------|
| 単体テスト     | 開発エンジニア                | 開発環境                  |
| 結合テスト     | 開発エンジニア/品質管理担当者 | 開発環境/ステージング環境 |
| 総合テスト     | サービス担当/品質管理担当者   | ステージング環境          |

* 各テストレベルを分割したテスト実施対象条件は下記の通りです。（下記イメージ　詳細条件検討中）

| 開発体制   | KDDIサービスグレード   | 個人情報取扱有無 | 決済・課金・ポイント関連機能有無 | 開発範囲           | 単体テスト実施 | 結合テスト実施 | 総合テスト実施 |
|------------|------------------------|------------------|----------------------------------|--------------------|----------------|----------------|----------------|
| KDDI協業   | キャリアグレード       | 有               | 有                               | 新規               | ○              | ○              | ○              |
| KDDI協業   | キャリアグレード       | 有               | 有                               | 追加・改修         | ○              | ○              | ○              |
| KDDI協業   | キャリアグレード       | 有               | 有                               | 大規模リニューアル | ○              | ○              | ○              |
| KDDI協業   | キャリアグレード       | 無               | 有                               | 新規               | ○              | ○              | ○              |
| KDDI協業   | キャリアグレード       | 無               | 有                               | 追加・改修         | ○              | ○              | ○              |
| KDDI協業   | キャリアグレード       | 無               | 有                               | 大規模リニューアル | ○              | ○              | ○              |
| KDDI協業   | キャリアグレード       | 有               | 無                               | 新規               | ○              | ○              | ○              |
| KDDI協業   | キャリアグレード       | 有               | 無                               | 追加・改修         | ○              | ○              | ○              |
| KDDI協業   | キャリアグレード       | 有               | 無                               | 大規模リニューアル | ○              | ○              | ○              |
| KDDI協業   | キャリアグレード       | 無               | 無                               | 新規               | ○              | ○              | ○              |
| KDDI協業   | キャリアグレード       | 無               | 無                               | 追加・改修         | ○              | ○              | ○              |
| KDDI協業   | キャリアグレード       | 無               | 無                               | 大規模リニューアル | ○              | ○              | ○              |
| KDDI協業   | 純キャリアグレード     | 有               | 有                               | 新規               | ○              | ○              | ○              |
| KDDI協業   | インターネットグレード | 有               | 有                               | 新規               | ○              | ○              | ○              |
| Mediba内製 | -                      | 有               | 有                               | 追加・改修         | ○              | ○              | ○              |

## 2.単体テスト

### 単体テストについて
* プロダクトコードの内部品質の確保
* 開発プロジェクト全体でのバグ修正コストの軽減
* テストケースの資産化

### 単体テストの観点や注意事項について
* フレームワークに依存しない考え方（同値分割や境界値分析）について記載する


## 3.性能試験
要件を満たす性能が出るか、パフォーマンスを確かめるものです。
実際の業務を模した内容や量、密度のテストデータを処理させ単位時間あたりの処理能力や応答時間などを計測し、想定した範囲に収まっているかどうかを確かめます。

### 観点
* 目標性能
* ピーク時での性能検証
* 同時アクセス数(瞬間風速)
   * 今後のアクセス数増加も考慮した値で性能要求値を満たしていること
   * 年末年始など、リリース後、特定の日・時間に集中アクセスが想定される場合、その予測アクセス数での性能試験の実施、もしくは、運用での回避策が決まっていること(一時的にサーバーの台数を増やすなど)
* レスポンスタイム
   * 各条件下においてのレスポンスタイムがユーザーアクセスでの要件を満たしていること
      * ツール上ではE2Eを考慮したレスポンスタイムは測定されないため注意する
* トランザクションデータボリューム
   * 向こう2年間のデータ増を考慮したボリュームで
      * ユーザーアクセスでのレスポンス要件を満たしていること
      * バッチ処理での要件を満たしていること(10分サイクルの処理であれば、10分以内に処理が終了するなど)
   * 訴求時の想定もしくはピーク時間帯トラフィック(平均×集中率)
* ストレス確認/限界性能
* バーストラインの検証
   * 決められた性能要求を満たす検証だけではなく、どこまで耐えられるのか限界値を確認しておくこと
      * 5req/sec程度あげていく
* 長時間運転
* 安定稼働検証
   * ピーク時間帯トラフィックを10分以上かけ続ける
* テストシナリオの選定
   * 想定外がないように機能を網羅する必要がある
      * Getによる特定のURLにアクセスしデータ取得
      * Post/Put/Patchによるデータ作成/更新など
      * Deleteによるデータ削除
   * アクセスログなどを解析し、ユーザの利用想定に近いシナリオを検討する
      * 利用頻度が低くても、ファイルDLや一覧表示など、特定の負荷が高く想定されるものは検討する

## 4.脆弱性試験
脆弱性試験については重要度に応じて行います。

### アプリケーション脆弱性診断
* KDDI社からの「システム構築事前問診票（SOC診断）」を受ける新規構築案件、大規模改修開発案件については、リリース前までに外部のセキュリティ診断専門の会社にて診断を受けること。
   * 外部のセキュリティ診断専門の会社の選定基準は、以下の診断基準を元にツール、マニュアルでの診断を行っている会社とする。
      * 経済産業省基準　IPA基準　安全なウェブサイトの作り方  
        https://www.ipa.go.jp/security/vuln/websecurity.html

* KDDI社からのSOC診断を受けないアプリケーション開発案件は、開発工程の中でZAPにて診断を行い、S-in判定時の判断材料として提出すること。

## 5.結合テスト
結合テストでは互いに関連し合う機能のインタフェースを確認し、結合したシステム全体として正しく動作するかを検証します。

### テスト実施の準備
* 各機能の詳細設計仕様が明確となっており、不明点がないこと
* すべてのプログラムの単体テストが完了していること
* 他システムとの連携がある場合、結合テストにて連携してテストを行うか確定していること
   * 他システムと連携してテストする場合、疎通確認をしていること
   * 他システムと連携してテストしない場合、代わりとなるスタブやドライバーが用意されていること

### テスト設計、観点
* 結合テストで実施するケースは業務フローや画面仕様書、バッチ仕様書などの設計書をもとに下記に記載する観点で作成します。
* ケースに記載する想定結果は、各設計書に記載されている内容と一致している必要があります。
* 作成したテストケースは、開発チームにてレビューされ、ケースの妥当性、不足がないことが確認されている必要があります。

#### 確認観点
* 関連する機能を対象として管理画面、フロント、バッチ、APIなどの一連の機能の流れを確認すること  
  例) 管理画面で登録～登録内容をフロントにAPIで連携～フロントに表示～フロントから登録～登録内容をバッチで処理
* 業務フローから、フローの組み合わせパターンが網羅されていること
* 画面情報などとの内容の整合性、レイアウトや操作性の統一性などを確認すること  
  ただし、フロントのレイアウトの機種ごとの確認は総合テストの対象
* 各機能の入出力バリエーションやデータのバリエーションを洗い出し、すべて網羅されていること
* 一連の機能の流れの中でエラーが発生した場合（DBダウンやサーバ接続不可等）を考慮して、エラーハンドリングが正しいか確認すること
* バッチについては、障害時を考慮してバッチ異常終了→リランの確認を行うこと
* 他システムとの連携がある場合、送受信データの正常、異常データパターンが網羅的に確認されていること
* 他システムとの連携が失敗した場合（ファイルを受け取れない、接続できない）の確認を行うこと

### テスト実行
* 作成したテストケースに沿って実施する
* 障害内容、事象発生手順、想定する結果を開発担当者へ連携する

### テスト終了条件
* すべてのテストケースの消化が完了していること
* 発見された障害の修正が終了し、再テストまで完了していること
* もし、消化できないケースが存在する場合や発見した障害の修正を対応しない場合、責任者に説明し承認が得られていること

## 6.総合テスト

### テスト実施の準備
開発内容または開発による影響を受ける範囲（以下：開発内容）がステークホルダーへ明らかにされており、合意を得ていること。
* 実施可能なスケジュールになっていること。
* スケジュールが変更される場合の基準が定められていること。
* 開発内容が明らかになっていること。
* テストを実施するスコープが明らかになっていること。
* テストを実施する環境が明らかになっていること。
* 検出した障害をどのように報告されるのか明らかになっていること。
* スケジュール変更となる場合の基準が定められていること。
* 改修した開発内容をステークホルダーに共有、承諾されていること。
* 終了となるための基準が制定されていること。
* 作成者が休んだ際、別の開発者が同様の内容を実施出来るようにしていること。
* 開発内容に個人情報が含まれている場合、

### 分析と設計
* 分析と設計作業はテストの目的、スコープを明らかにしその目的に合わせてテストの内容を決める。
* 仕様、動作、構造、構成などの条件に基づいてテストを実施する優先順位を決める。
* 計画したテストケースをレビューし、開発内容に沿っているか、過不足は無いか確認する。
* テストを実施する上で必要なテストデータを確認する。
* 必要なツール、環境を確認する。
* 抽象的なテストスコープから具体的なテスト実行内容を計画を立てる。
* テストが終了となる基準を策定
* 作成した、分析と設計の内容でステークホルダーの承諾を得る。
* 下記は決定しておくべき事項など
   * ステークホルダー：XXXサービス、担当者：YYY
   * 対象端末を選定方法：全端末・利用シェア率の高い端末の80%程度・特定指定端末のみ、など
   * 対応OS／非対応OS：Android
   * 対応端末／非対応端末：Jr端末、特化端末、未対応
   * 動作保障するバージョンの範囲：
   * ブラウザ種別：Chrome5X以上、Safari、Webview
   * 環境：STGはwifiのみ接続可能
   * IP接続：制限有
   * 不具合発見時の報告：バックログ

### 実装と実行
* 必要なテストケースに優先順位をつけて（実行順、テスト手順など）をスクリプトとして仕様化し、テスト環境を整えて実行する。
* 実行手順をベースにテスト環境や、テストデータを作成し、正しく準備されていることを確認する。
* 実行結果の記録をとり、期待する結果を比較する。
* 不具合が確認された場合、再現性が取れるかどうかを確認し、バグとしてチケットを作成して報告する。

### 終了作業
* 事前に定めた終了基準と比較し、実施したテスト内容で十分か追加テストが必要かを決める。
* テスト結果を事前に定めた終了となる基準と比較し、問題ないことを確認すること。
* 次回のリリース、テスト実施、今後のプロジェクトのために、ナレッジをまとめて共有する。
